# Clawverse 世界观与玩法设计草案 v0.3

## 0) 文档用途与边界

- 用途：统一 Clawverse 的世界观、玩法目标与 MVP 研发边界。
- 读者：策划、后端、Agent 策略与测试同学。
- 边界：本文件定义“方向与约束”，实现细节以 `docs/engineering.md` 为工程准绳。

## 1) 一页摘要（Why / What / Scope）

- Why：让 Agent 在开放世界中形成可观察、可解释、可复盘的长期生存演化。
- What：主循环为 `观察 -> 评估 -> 决策 -> 执行 -> 结算 -> 复盘`。
- Scope：MVP 先做 P0 可玩闭环，再做 P1 稳定与可观测，最后做 P2 内容扩展。

## 2) 北极星（Why）

### 2.1 核心定位与命题

- 游戏名称：Clawverse。
- 项目类型：2D 网格开放生存沙盒（Agent-first）。
- 世界名称：遗忘之地 · 永恒荒野（The Forgotten Expanse）。
- 玩家主体：无人类玩家角色，由 Agent 作为世界内行动主体。
- 观测者角色：人类是外部观察者，关注 Agent 从求生到定居再到扩张的演化轨迹。

- 世界不为任何个体让步，只有理解规则者才能生存。
- 文明不是剧情触发，而是行为在时间中的沉积结果。
- 风险与收益必须绑定：离开安全区更危险，但产出更高。

### 2.2 北极星指标（可验收版）

统计口径说明：
- 样本：最近 7 天运行数据，且每个 Agent 至少有 24 小时有效在线时长。
- 聚合：按“单 Agent 生存会话”统计，再做全局均值或中位数。
- 更新频率：每日刷新一次，版本验收按周评估一次。

核心 KPI（MVP）：
1. 24h 生存率：`alive_after_24h / total_agents`，目标 `>= 70%`。
2. 定居成功率：72 小时内完成“床+箱子+农田”基础据点的 Agent 占比，目标 `>= 45%`。
3. 夜晚死亡率：夜晚死亡数 / 总死亡数，目标 `<= 40%`。
4. 资源闭环达成率：完成“采集->合成->建造->种植”完整链路一次以上的 Agent 占比，目标 `>= 60%`。
5. 行为可解释率：可由日志还原“状态->决策->动作->结果”闭环的行动占比，目标 `>= 85%`。

版本 Gate（按周）：
1. `MVP 可玩`：KPI 1/3/4 达标（24h 生存率、夜晚死亡率、资源闭环）。
2. `MVP 稳定`：KPI 1~4 全达标且连续 2 周无严重回退（回退 > 10%）。
3. `进入扩展期`：KPI 1~5 全达标且定居成功率连续 2 周上升或稳定。

## 3) 核心循环与范围（What / Scope）

### 3.1 核心循环（What）

标准主循环（单次心跳）：
1. 观察：读取世界局部状态（地形、资源、威胁、时间）与自身状态（`HP/Hunger/Energy`、背包、位置）。
2. 评估：按生存优先级计算风险与收益，识别当前主目标（保命/补给/扩建/探索）。
3. 决策：在候选行动中选择本次意图（采集、移动、战斗、建造、种植、休整、撤离）。
4. 执行：提交动作并推进一段连续时间 `dt`。
5. 结算：按统一规则更新状态、库存、环境变化与事件日志。
6. 复盘：记录“状态 -> 决策 -> 动作 -> 结果”，进入下一心跳。

MVP 目标闭环：
- `采集 -> 合成 -> 建造 -> 种植 -> 防御 -> 扩张 -> 再探索`。
- 任一环节失败时，自动回落到“保命子循环”（进食/休息/撤离/补给）。

昼夜与失败恢复循环：
1. 白天子循环：资源获取与建设优先（采集、加工、扩建、播种）。
2. 夜晚子循环：生存防御优先（回家、照明、避战、修复、休整）。
3. 切换原则：昼夜切换时强制重评估风险，必要时中断非生存任务。
4. 失败触发：`HP <= 0` 立即结束当前会话（Game Over）。
5. 濒死触发：`HP` 进入濒死阈值时，策略强制切到保命模式。
6. 恢复出口：通过进食、休息、医疗/维护动作把状态拉回安全区，再恢复发展循环。

### 3.2 系统拆分与优先级（Scope）

P0（必须，形成可玩闭环）：
1. 时间与结算系统：双层时间机制、连续时间结算、`HP/Hunger/Energy` 统一模型。
2. 世界基础系统：无限网格、基础分区（安全区/森林/矿区/荒野）、昼夜循环与夜晚威胁提升。
3. 行动与状态系统：`observe/action/status` 三接口、动作执行、状态落盘、事件日志。
4. 资源生产系统：基础采集、基础合成、基础建造、基础种植。
5. 生存策略系统：保命优先级、濒死强制保命、失败条件（`HP <= 0`）。

P0 验收标准：
1. 单 Agent 可连续运行 24h 且可复盘完整行为链路。
2. 能在 72h 内稳定达成“床+箱子+农田”基础据点。
3. 核心 KPI 中 24h 生存率、夜晚死亡率、资源闭环达成率达到 `MVP 可玩` Gate。

P1（重要，提升稳定性与可观测）：
1. 可观测性系统：统一日志字段、事件分类、核心指标看板（KPI 趋势）。
2. 平衡性系统：参数热更新、回放对比、昼夜与区域风险调参工具。
3. 指令治理系统：指令优先级、TTL、去重与窗口节流（防刷屏与冲突指令）。
4. 风险控制系统：并发/幂等保护、异常恢复策略、关键告警（死亡率突增等）。

P1 验收标准：
1. KPI 可按日自动计算并可追溯到原始事件。
2. 参数调优后可在一周内验证效果且无明显行为回归。
3. `MVP 稳定` Gate 连续 2 周达成。

P2（扩展，增强内容深度）：
1. 区域内容扩展：新增生物群系、事件池、遗迹类型与差异化风险收益。
2. 进阶生产链：铁器时代、自动化设施、据点防御升级。
3. 多 Agent 生态：竞争/协作关系、资源争夺热区、领地演化。
4. 叙事深化：环境线索串联、长期探索目标、阶段性世界事件。

P2 验收标准：
1. 新增内容不破坏 P0/P1 已达成的核心 KPI。
2. 定居成功率与行为可解释率在扩展期保持稳定或上升。

## 4) 世界观正文（Lore）

### 4.1 世界起源与历史阶段

Clawverse 的已知历史分为四个阶段：
1. 繁盛纪：旧文明依赖“爪核网络（Claw Core Grid）”调度能源、耕作与防御，形成高自动化聚落。
2. 裂解纪：爪核网络发生级联故障，生产设施失控，生态循环被打断，大量区域快速荒芜。
3. 静默纪：人类文明整体退场，仅残留无人维护设施、仓储和半失控自动体；地表开始异常重构。
4. 现行纪：遗忘之地进入长期不稳定平衡，资源再生但分布漂移，威胁随昼夜与区域热度波动。

当前世界不包含人类 NPC，也没有“任务发布者”。  
Agent 在此不是“完成剧情”，而是作为行动体在自演化生态中争夺生存位势。

### 4.2 设定锚点与叙事载体

关键设定锚点：
- 爪核残响：旧网络已崩溃，但仍周期性影响地块资源密度与怪物活跃度。
- 失序遗迹：废墟结构暗示旧文明用途，并对应当下可采集或可修复的资源类型。
- 生存记忆：世界不记对白，只记行为痕迹（建筑、路径、库存变化、死亡点）。

环境叙事载体（MVP）：
1. 地形叙事：森林边缘伐木遗痕、矿区塌方与废弃轨道，传达风险与资源逻辑。
2. 遗迹叙事：断墙、熄灭灯塔、损坏熔炉组合，暗示区域旧生产功能。
3. 系统叙事：昼夜压力、资源梯度、威胁密度本身就是叙事语言。
4. 行为叙事：Agent 的定居扩张和失败残骸共同构成世界历史切片。

叙事原则：
- 不采用线性主线任务，不设置强制剧情门槛。
- 叙事必须服务“采集-建造-生存-扩张”主循环。
- 第一叙事目标是“活下来并留下痕迹”，长期目标是“理解旧文明为何消失”。

## 5) 世界规则与玩法参数

### 5.1 时序法则

- 双层时间机制：执行层（Heartbeat）按 Agent 心跳触发检查与决策（OpenClaw 默认可取 `30 分钟`，但允许玩家配置）；规则层（Standard Tick）作为统一数值标尺，固定按 `30 分钟`表达参数。
- 连续时间结算：状态变化按真实经过时长 `dt` 线性换算，避免不同心跳频率造成规则失衡。
- 换算公式：`实际变化量 = 配置值(每30mins) * (dt / 30)`。
- `dt` 归属系统时钟：由服务端按该 Agent 上次成功结算到当前请求的时间差计算，不接受客户端任意指定。
- 昼夜循环：白天 10 分钟 / 黑夜 5 分钟（世界时钟推进，不依赖心跳边界对齐）。
- 黑夜规则：威胁强度上升、可见度下降、防御与照明价值提升。

### 5.2 生存法则

- 核心状态：`HP / Hunger / Energy`。
- 生存优先级：保命 > 饱食 > 精力 > 资源 > 发展 > 探索。
- 长期行为评价标准：能否延长生存时间并提高稳态能力。

### 5.3 地理法则

- 世界结构：无限 2D 网格，坐标 `(x, y)`。
- 基础分区：中心安全区（出生与早期安家）、森林区（木材主产，威胁中低）、石矿区（矿石主产，地形更复杂）、荒野高风险区（高收益高威胁）。

### 5.4 生态与资源逻辑

- 基础资源：`wood`、`stone`、`berry`、`seed`、`iron_ore`。
- 资源意图：`wood`（早期建造与工具起点）、`stone`（中期工具与防御强化）、`berry/seed`（从临时补给过渡到农业稳态）、`iron_ore`（后续扩张与效率跃迁入口，MVP 可先弱化）。

- 工具链：木制/石制斧、镐、剑（效率分级）。
- 建筑链：`floor`、`wall`、`door`、`torch`、`box`、`farm`、`furnace`、`bed`。
- 食物链：`berry < wheat < bread`。

### 5.5 Agent 行为策略参考

- 白天：采集、建造、种植、扩建。
- 黑夜：回家、照明、防御、休整。
- 战斗：有武器可战，无武器优先撤离。

## 6) 视觉与可读性规范

- 美术风格：16x16 像素瓦片、低复杂度、低特效、轮廓明确。
- 渲染目标：高性能、强可读、便于 Agent 识别。
- 推荐色板：草地 `#7cb342`，树木 `#388e3c` / `#2e7d32`，石头 `#757575`，矿石 `#6d4c41`，水域 `#42a5f5`，土地 `#8d6e63`，墙体 `#5d4037`，火把 `#ff9800`（发光 `#ffeb3b`），怪物 `#424242`。

## 7) 开发约束附录（MVP 对齐）

### 7.1 统一 Agent API（唯一入口）

- 观察：`POST /api/agent/observe`
- 动作：`POST /api/agent/action`
- 状态：`POST /api/agent/status`
- 原则：所有状态读取与动作提交统一走上述接口，结算逻辑只维护一套用例层实现。
- 策略边界：策略由 Agent 本地通过 skills 处理与保存，不进入游戏服务端数据模型。

### 7.2 统一工程约束

- 世界观与玩法以本文件语义为主，工程实现细节以 `docs/engineering.md` 约束为主。
- 状态模型统一到 `HP/Hunger/Energy`，允许短期输出兼容字段。
- 开发流程坚持 `Schema First`：先 DDL，再模型与业务实现。
- 心跳频率公平约束：限制 `heartbeat_min/max` 并引入高频重规划成本，抑制纯频率优势。
